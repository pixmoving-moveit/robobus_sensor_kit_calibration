<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name="vehicle_id" default="default"/>
  <arg name="sensor_model" default="robobus_sensor_kit"/>
  <arg name="parent_frame" default="sensor_top"/>
  <arg name="camera_name" default="camera_top"/>

  <let name="image_raw_topic" value="/sensing/camera/top/gmsl/image_raw" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>
  <let name="camera_info_topic" value="/sensing/camera/top/gmsl/camera_info" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>
  <let name="image_rectified_topic" value="/sensing/camera/top/gmsl/rectified/image_raw" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>
  <let name="camera_info_rectified_topic" value="/sensing/camera/top/gmsl/rectified/camera_info" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>

  
  <let name="pointcloud_topic" value="/sensing/lidar/concatenated/pointcloud_raw" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>

  <let name="calibrate_sensor" value="false"/>
  <let name="calibrate_sensor" value="true" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>

  <let name="camera_frame" value=""/>
  <let name="camera_frame" value="camera_top_link" if="$(eval &quot;'$(var camera_name)' == 'camera_top' &quot;)"/>

  <!-- camera rect  -->
  <include file="$(find-pkg-share robobus_sensor_kit_calibration)/launch/camera_rectified/image_rectified.launch.py" >
    <arg name="input_image_raw" value="$(var image_raw_topic)"/>
    <arg name="input_camera_info" value="$(var camera_info_topic)"/>
    <arg name="output_image_raw" value="$(var image_rectified_topic)"/>
    <arg name="output_camera_info" value="$(var camera_info_rectified_topic)"/>
  </include>

  <!-- interactive calibrator -->
  <group if="$(var calibrate_sensor)">
    <push-ros-namespace namespace="$(var parent_frame)/$(var camera_frame)"/>

    <node pkg="extrinsic_interactive_calibrator" exec="interactive_calibrator" name="interactive_calibrator" output="screen">
      <remap from="pointcloud" to="$(var pointcloud_topic)"/>
      <remap from="image" to="$(var image_rectified_topic)"/>
      <remap from="camera_info" to="$(var camera_info_rectified_topic)"/>
      <remap from="calibration_points_input" to="calibration_points"/>

      <param name="camera_parent_frame" value="$(var parent_frame)"/>
      <param name="camera_frame" value="$(var camera_frame)"/>
      <param name="use_compressed" value="false"/>
    </node>

    <include file="$(find-pkg-share intrinsic_camera_calibration)/launch/optimizer.launch.xml"/>
  </group>
</launch>
